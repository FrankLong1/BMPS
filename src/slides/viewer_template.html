<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[PROJECT_NAME] - Live Slide Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            overflow-x: hidden;
        }

        #viewer-container {
            width: 100%;
            min-height: 100vh;
        }

        #viewer-header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        #viewer-header h1 {
            font-size: 24px;
            color: #333;
            font-weight: 600;
        }

        .viewer-stats {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #666;
        }

        .viewer-stats span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .view-mode {
            display: none;
            padding: 20px;
        }

        .view-mode.active {
            display: block;
        }

        .slide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .slide-container {
            position: relative;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .slide-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .slide-container.recently-updated {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
            animation: highlight-fade 2s ease-out;
        }

        @keyframes highlight-fade {
            0% {
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
            }
            100% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }
        }

        .slide-header {
            padding: 10px 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .slide-number {
            font-weight: 600;
            color: #495057;
        }

        .slide-timestamp {
            color: #6c757d;
            font-size: 11px;
        }

        .slide-iframe-wrapper {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            background: #f8f9fa;
        }

        .slide-iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 1920px;
            height: 1080px;
            border: none;
            transform: scale(0.208333); /* Scale down from 1920x1080 to 400x225 */
            transform-origin: top left;
        }

        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border: 3px solid #e9ecef;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: none;
        }

        .loading .loading-spinner {
            display: block;
        }

        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        #fullscreen-view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: #000;
            z-index: 1000;
        }

        .fullscreen-controls {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        #back-to-grid {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        #back-to-grid:hover {
            background: rgba(255,255,255,0.2);
        }

        #slide-position {
            color: white;
            font-size: 14px;
            background: rgba(0,0,0,0.5);
            padding: 5px 12px;
            border-radius: 4px;
        }

        #fullscreen-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        .navigation {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            pointer-events: none;
        }

        .navigation button {
            pointer-events: auto;
            background: rgba(0,0,0,0.5);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .navigation button:hover {
            background: rgba(0,0,0,0.7);
        }

        .navigation button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }


        .no-slides {
            text-align: center;
            padding: 100px 20px;
            color: #6c757d;
            background: white;
            border-radius: 12px;
            max-width: 600px;
            margin: 40px auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .no-slides-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.05); opacity: 0.4; }
        }
        
        .waiting-message {
            font-size: 18px;
            color: #495057;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #e8f5e9;
            padding: 8px 16px;
            border-radius: 20px;
            color: #2e7d32;
            font-size: 14px;
            margin-top: 20px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            animation: blink 1.5s ease-in-out infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @media (max-width: 768px) {
            .slide-grid {
                grid-template-columns: 1fr;
            }
            
            #viewer-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
        }

        @media print {
            .fullscreen-controls,
            .navigation,
            #viewer-header,
            .filter-controls {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div id="viewer-container">
        <header id="viewer-header">
            <h1>[PROJECT_NAME] - Live Slide Viewer</h1>
            <div class="viewer-stats">
                <span id="slide-count">0 slides</span>
                <span id="last-update">Last update: --</span>
            </div>
        </header>

        <div id="grid-view" class="view-mode active">
            <div class="slide-grid" id="slide-grid">
                <!-- Slides will be dynamically inserted here -->
            </div>
            <div class="no-slides" id="no-slides" style="display: none;">
                <div class="no-slides-icon">üëÄ</div>
                <div class="waiting-message">Waiting for slides...</div>
                <p style="color: #6c757d; margin-bottom: 5px;">The slide generation agents haven't started yet.</p>
                <p style="font-size: 14px; opacity: 0.7;">Slides will appear here automatically as they're created.</p>
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span>Viewer Active - Smart refresh enabled</span>
                </div>
            </div>
        </div>

        <div id="fullscreen-view" class="view-mode">
            <div class="fullscreen-controls">
                <button id="back-to-grid">‚Üê Back to Grid</button>
                <span id="slide-position">1 of 1</span>
            </div>
            <iframe id="fullscreen-iframe"></iframe>
            <div class="navigation">
                <button id="prev-slide">‚Äπ</button>
                <button id="next-slide">‚Ä∫</button>
            </div>
        </div>
    </div>

    <script>
        class SlideViewer {
            constructor() {
                this.slides = [];
                this.currentSlides = new Map();
                this.lastModified = new Map();
                this.fileChecksums = new Map(); // Track file content changes
                this.currentFullscreenIndex = 0;
                this.filterText = '';
                this.refreshInterval = 500; // Check every 500ms but only refresh if changed
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.startAutoRefresh();
                this.scanForSlides();
            }

            setupEventListeners() {
                // Fullscreen controls
                document.getElementById('back-to-grid').addEventListener('click', () => {
                    this.exitFullscreen();
                });

                document.getElementById('prev-slide').addEventListener('click', () => {
                    this.navigateSlide(-1);
                });

                document.getElementById('next-slide').addEventListener('click', () => {
                    this.navigateSlide(1);
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (!this.isFullscreen()) return;

                    switch(e.key) {
                        case 'Escape':
                            this.exitFullscreen();
                            break;
                        case 'ArrowLeft':
                            this.navigateSlide(-1);
                            break;
                        case 'ArrowRight':
                        case ' ':
                            this.navigateSlide(1);
                            break;
                    }
                });
            }

            scanForSlides() {
                // Simple approach: just create containers for slides 01-15 
                // (we know we're generating 15 slides for this presentation)
                const potentialSlides = [];
                
                for (let i = 1; i <= 15; i++) {
                    const slideNum = String(i).padStart(2, '0');
                    const slideFile = `slide_${slideNum}.html`;
                    potentialSlides.push(slideFile);
                }
                
                this.slides = potentialSlides;
                this.updateSlideGrid();
                this.updateStats();
            }

            updateSlideGrid() {
                const grid = document.getElementById('slide-grid');
                const noSlides = document.getElementById('no-slides');
                
                if (this.slides.length === 0) {
                    grid.style.display = 'none';
                    noSlides.style.display = 'block';
                    return;
                }
                
                grid.style.display = 'grid';
                noSlides.style.display = 'none';

                // Add new slides
                this.slides.forEach((slideFile, index) => {
                    if (!this.currentSlides.has(slideFile)) {
                        const container = this.createSlideContainer(slideFile, index);
                        grid.appendChild(container);
                        this.currentSlides.set(slideFile, container);
                    }
                });

                // Remove deleted slides
                for (const [slideFile, container] of this.currentSlides) {
                    if (!this.slides.includes(slideFile)) {
                        container.remove();
                        this.currentSlides.delete(slideFile);
                    }
                }
            }

            createSlideContainer(slideFile, index) {
                const container = document.createElement('div');
                container.className = 'slide-container';
                container.dataset.slide = slideFile;
                
                const slideNum = parseInt(slideFile.match(/\d+/)?.[0] || '0');
                
                container.innerHTML = `
                    <div class="slide-header">
                        <span class="slide-number">Slide ${slideNum}</span>
                        <span class="slide-timestamp">--</span>
                    </div>
                    <div class="slide-iframe-wrapper">
                        <div class="loading-spinner"></div>
                        <iframe class="slide-iframe" src="slides/${slideFile}" data-slide="${slideFile}"></iframe>
                    </div>
                `;

                const iframe = container.querySelector('.slide-iframe');
                const spinner = container.querySelector('.loading-spinner');
                
                // Show spinner initially
                spinner.style.display = 'block';
                
                // Handle successful load
                iframe.addEventListener('load', () => {
                    // Always hide spinner and show container
                    spinner.style.display = 'none';
                    container.style.display = 'block';
                    
                    // Update timestamp and track modification time
                    const timestampEl = container.querySelector('.slide-timestamp');
                    const now = new Date();
                    
                    // Only update if not already showing a time (to detect actual changes)
                    if (timestampEl.textContent === 'Waiting...' || timestampEl.textContent === '--') {
                        timestampEl.textContent = now.toLocaleTimeString();
                        this.lastModified.set(slideFile, now.getTime());
                        
                        // Add recent update highlight for new slides
                        container.classList.add('recently-updated');
                        setTimeout(() => {
                            container.classList.remove('recently-updated');
                        }, 2000);
                    } else {
                        // This is a refresh of existing slide
                        timestampEl.textContent = now.toLocaleTimeString();
                    }
                });
                
                // Handle error (slide doesn't exist yet)
                iframe.addEventListener('error', () => {
                    spinner.style.display = 'none';
                    // Keep container visible but show it's waiting
                    const timestampEl = container.querySelector('.slide-timestamp');
                    timestampEl.textContent = 'Waiting...';
                });
                
                // Fallback timeout for file:// protocol issues
                setTimeout(() => {
                    if (spinner.style.display === 'block') {
                        spinner.style.display = 'none';
                        const timestampEl = container.querySelector('.slide-timestamp');
                        timestampEl.textContent = 'Waiting...';
                    }
                }, 3000);

                // Click to fullscreen (only if loaded)
                container.addEventListener('click', (e) => {
                    if (!e.target.closest('.slide-header') && !spinner.style.display) {
                        this.enterFullscreen(index);
                    }
                });

                return container;
            }

            checkForUpdates() {
                // For file:// protocol, we use a simpler approach
                // Refresh slides that are waiting or haven't loaded yet
                this.currentSlides.forEach((container, slideFile) => {
                    const timestampEl = container.querySelector('.slide-timestamp');
                    const iframe = container.querySelector('.slide-iframe');
                    
                    if (!iframe) return;
                    
                    // Always refresh if showing "Waiting..." or "--"
                    if (timestampEl && (timestampEl.textContent === 'Waiting...' || timestampEl.textContent === '--')) {
                        this.refreshSingleSlide(slideFile, container);
                    } else if (!this.fileChecksums.has(slideFile)) {
                        // First time seeing this slide - refresh it
                        this.fileChecksums.set(slideFile, Date.now());
                        this.refreshSingleSlide(slideFile, container);
                    } else {
                        // For already loaded slides, refresh periodically (every 3 seconds)
                        const lastRefresh = this.fileChecksums.get(slideFile);
                        if (Date.now() - lastRefresh > 3000) {
                            this.fileChecksums.set(slideFile, Date.now());
                            this.refreshSingleSlide(slideFile, container);
                        }
                    }
                });
                
                // Update last check time
                document.getElementById('last-update').textContent = 
                    `Last check: ${new Date().toLocaleTimeString()}`;
            }
            
            refreshSingleSlide(slideFile, container) {
                const iframe = container.querySelector('.slide-iframe');
                if (iframe) {
                    const timestamp = Date.now();
                    const baseSrc = iframe.src.split('?')[0];
                    iframe.src = `${baseSrc}?t=${timestamp}`;
                }
            }


            enterFullscreen(index) {
                this.currentFullscreenIndex = index;
                const slideFile = this.slides[index];
                
                document.getElementById('grid-view').classList.remove('active');
                document.getElementById('fullscreen-view').classList.add('active');
                
                const iframe = document.getElementById('fullscreen-iframe');
                iframe.src = `slides/${slideFile}?t=${Date.now()}`;
                
                this.updateFullscreenNavigation();
            }

            exitFullscreen() {
                document.getElementById('fullscreen-view').classList.remove('active');
                document.getElementById('grid-view').classList.add('active');
                
                // Clear fullscreen iframe
                document.getElementById('fullscreen-iframe').src = '';
            }

            isFullscreen() {
                return document.getElementById('fullscreen-view').classList.contains('active');
            }

            navigateSlide(direction) {
                const newIndex = this.currentFullscreenIndex + direction;
                
                if (newIndex >= 0 && newIndex < this.slides.length) {
                    this.currentFullscreenIndex = newIndex;
                    const slideFile = this.slides[newIndex];
                    
                    const iframe = document.getElementById('fullscreen-iframe');
                    iframe.src = `slides/${slideFile}?t=${Date.now()}`;
                    
                    this.updateFullscreenNavigation();
                }
            }

            updateFullscreenNavigation() {
                const prevBtn = document.getElementById('prev-slide');
                const nextBtn = document.getElementById('next-slide');
                const position = document.getElementById('slide-position');
                
                prevBtn.disabled = this.currentFullscreenIndex === 0;
                nextBtn.disabled = this.currentFullscreenIndex === this.slides.length - 1;
                
                position.textContent = `${this.currentFullscreenIndex + 1} of ${this.slides.length}`;
            }

            updateStats() {
                document.getElementById('slide-count').textContent = 
                    `${this.slides.length} slide${this.slides.length !== 1 ? 's' : ''}`;
            }

            startAutoRefresh() {
                // Refresh all iframes every 500ms
                setInterval(() => {
                    if (!this.isFullscreen()) {
                        this.checkForUpdates();
                    }
                }, this.refreshInterval);

                // Scan for new slides every 2 seconds
                setInterval(() => {
                    this.scanForSlides();
                }, 2000);
            }
        }

        // Initialize viewer when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new SlideViewer();
        });
    </script>
</body>
</html>